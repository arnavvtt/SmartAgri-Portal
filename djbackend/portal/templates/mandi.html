{% load static %}
<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>‡§Æ‡§Ç‡§°‡•Ä ‡§≠‡§æ‡§µ | Smart Agriculture Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f7f6;
            margin: 0;
        }
        header {
            background: #2e7d32;
            color: white;
            padding: 15px;
            text-align: center;
        }
        nav {
            padding: 10px;
            background: #e8f5e9;
            text-align: center;
        }
        nav a {
            margin: 0 10px;
            text-decoration: none;
            color: #2e7d32;
            font-weight: bold;
        }
        .container {
            max-width: 1100px;
            margin: auto;
            padding: 20px;
        }
        .date {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .controls input,
        .controls select {
            padding: 8px;
            font-size: 14px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }
        th {
            background: #e8f5e9;
            color: #2e7d32;
        }
        tr:hover {
            background: #f1f8e9;
        }
        .high { color: green; font-weight: bold; }
        .low { color: red; font-weight: bold; }
        .normal { color: #ff9800; font-weight: bold; }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 25px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        footer {
            text-align: center;
            padding: 10px;
            color: #666;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<!-- NAVBAR (Django URLs only) -->
<nav>
    <a href="{% url 'home' %}">Home</a>
    <a href="{% url 'dashboard' %}">Dashboard</a>
    <a href="{% url 'weather' %}">Weather</a>
    <a href="{% url 'mandi' %}">Mandi</a>
</nav>

<header>
    <h1>üåæ ‡§Æ‡§Ç‡§°‡•Ä ‡§≠‡§æ‡§µ</h1>
    <p>Smart Agriculture Portal</p>
</header>

<div class="container">

    <div class="date" id="todayDate"></div>

    <!-- Controls -->
    <div class="controls">
        <input type="text" id="searchCrop" placeholder="‡§´‡§∏‡§≤ ‡§ñ‡•ã‡§ú‡•á‡§Ç" onkeyup="filterTable()">

        <select id="mandiFilter" onchange="filterTable()">
            <option value="">‡§∏‡§≠‡•Ä ‡§Æ‡§Ç‡§°‡•Ä</option>
            <option value="‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä">‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä</option>
            <option value="‡§≤‡§ñ‡§®‡§ä">‡§≤‡§ñ‡§®‡§ä</option>
            <option value="‡§≠‡•ã‡§™‡§æ‡§≤">‡§≠‡•ã‡§™‡§æ‡§≤</option>
            <option value="‡§ú‡§Ø‡§™‡•Å‡§∞">‡§ú‡§Ø‡§™‡•Å‡§∞</option>
        </select>

        <select id="sortPrice" onchange="sortTable()">
            <option value="">‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§õ‡§æ‡§Ç‡§ü‡•á‡§Ç</option>
            <option value="low">‡§ï‡§Æ ‡§∏‡•á ‡§Ö‡§ß‡§ø‡§ï</option>
            <option value="high">‡§Ö‡§ß‡§ø‡§ï ‡§∏‡•á ‡§ï‡§Æ</option>
        </select>
    </div>

    <!-- Table -->
    <table id="mandiTable">
        <thead>
            <tr>
                <th>‡§´‡§∏‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ</th>
                <th>‡§Æ‡§Ç‡§°‡•Ä</th>
                <th>‡§Æ‡•Ç‡§≤‡•ç‡§Ø (‚Çπ / ‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤)</th>
                <th>‡§∏‡•ç‡§•‡§ø‡§§‡§ø</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>‡§ó‡•á‡§π‡•Ç‡§Ç</td><td>‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä</td><td>2250</td><td class="normal">‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø</td></tr>
            <tr><td>‡§ß‡§æ‡§®</td><td>‡§≤‡§ñ‡§®‡§ä</td><td>2100</td><td class="low">‡§ï‡§Æ</td></tr>
            <tr><td>‡§Æ‡§ï‡•ç‡§ï‡§æ</td><td>‡§≠‡•ã‡§™‡§æ‡§≤</td><td>1950</td><td class="low">‡§ï‡§Æ</td></tr>
            <tr><td>‡§ö‡§®‡§æ</td><td>‡§ú‡§Ø‡§™‡•Å‡§∞</td><td>5400</td><td class="high">‡§Ö‡§ß‡§ø‡§ï</td></tr>
            <tr><td>‡§∏‡§∞‡§∏‡•ã‡§Ç</td><td>‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä</td><td>5650</td><td class="high">‡§Ö‡§ß‡§ø‡§ï</td></tr>
            <tr><td>‡§™‡•ç‡§Ø‡§æ‡§ú</td><td>‡§≠‡•ã‡§™‡§æ‡§≤</td><td>1600</td><td class="normal">‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø</td></tr>
            <tr><td>‡§Ü‡§≤‡•Ç</td><td>‡§≤‡§ñ‡§®‡§ä</td><td>1200</td><td class="low">‡§ï‡§Æ</td></tr>
        </tbody>
    </table>

    <!-- Chart -->
    <div class="card">
        <h2>üìä ‡§´‡§∏‡§≤ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø ‡§§‡•Å‡§≤‡§®‡§æ ‡§ó‡•ç‡§∞‡§æ‡§´</h2>
        <canvas id="priceChart"></canvas>
    </div>

</div>

<footer>
    ¬© 2026 Smart Agriculture Portal
</footer>

<script>
document.getElementById("todayDate").innerText =
    "‡§Ü‡§ú ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ: " + new Date().toLocaleDateString("hi-IN");

function filterTable() {
    const cropInput = document.getElementById("searchCrop").value.toLowerCase();
    const mandiValue = document.getElementById("mandiFilter").value;
    const rows = document.querySelectorAll("#mandiTable tbody tr");

    rows.forEach(row => {
        const crop = row.cells[0].innerText.toLowerCase();
        const mandi = row.cells[1].innerText;

        const cropMatch = crop.includes(cropInput);
        const mandiMatch = mandiValue === "" || mandi === mandiValue;

        row.style.display = (cropMatch && mandiMatch) ? "" : "none";
    });

    loadChart();
}

function sortTable() {
    const tbody = document.querySelector("#mandiTable tbody");
    const rows = Array.from(tbody.rows);
    const type = document.getElementById("sortPrice").value;

    if (!type) return;

    rows.sort((a, b) => {
        const x = parseInt(a.cells[2].innerText);
        const y = parseInt(b.cells[2].innerText);
        return type === "low" ? x - y : y - x;
    });

    rows.forEach(row => tbody.appendChild(row));
    loadChart();
}

let chart;
function loadChart() {
    const crops = [];
    const prices = [];

    document.querySelectorAll("#mandiTable tbody tr").forEach(row => {
        if (row.style.display !== "none") {
            crops.push(row.cells[0].innerText);
            prices.push(row.cells[2].innerText);
        }
    });

    if (chart) chart.destroy();

    chart = new Chart(document.getElementById("priceChart"), {
        type: "bar",
        data: {
            labels: crops,
            datasets: [{
                label: "‚Çπ ‡§™‡•ç‡§∞‡§§‡§ø ‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤",
                data: prices
            }]
        },
        options: { responsive: true }
    });
}

loadChart();
</script>

</body>
</html>


